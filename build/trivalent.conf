# Trivalent flags

ARCH="$(arch)"
CHROMIUM_FLAGS=""
FEATURES=""

# USE_WAYLAND=[true|false]
USE_WAYLAND="${USE_WAYLAND}"
if [ "$USE_WAYLAND" == "false" ]; then
	CHROMIUM_FLAGS+=" --ozone-platform-hint=x11"
elif [ "$USE_WAYLAND" == "true" ] && [ "$XDG_SESSION_TYPE" == "wayland" ]; then
	CHROMIUM_FLAGS+=" --ozone-platform-hint=wayland"
else
	if [ "$USE_WAYLAND" == "true" ]; then
		echo "Wayland is not supported on X11 sessions"
	else
		echo "Value provided by 'USE_WAYLAND' empty or invalid, defaulting to '$XDG_SESSION_TYPE'"
	fi
	case "$XDG_SESSION_TYPE" in
	   wayland)
	      USE_WAYLAND="true"
	      ;;
	   x11)
	      USE_WAYLAND="false"
	      ;;
	esac
fi

# ENABLE_VULKAN=[true|false]
ENABLE_VULKAN="false"

# Other architectures are not tested for and should not be included yet
if [ "$ARCH" == "x86_64" ] ; then
	if [ "$USE_WAYLAND" == "false" ]; then
		CHROMIUM_FLAGS+=" --enable-native-gpu-memory-buffers"
		CHROMIUM_FLAGS+=" --enable-gpu-memory-buffer-video-frames"
		CHROMIUM_FLAGS+=" --enable-zero-copy"
		CHROMIUM_FLAGS+=" --ignore-gpu-blocklist"
		CHROMIUM_FLAGS+=" --disable-gpu-driver-bug-workaround"

		# Enable Vulkan
		# (Vulkan is not supported on Wayland, it is also experimental)
		ENABLE_VULKAN="true"
	fi

	if [ "$ENABLE_VULKAN" == "true" ]; then
		CHROMIUM_FLAGS+=" --use-angle=vulkan --use-vulkan"
		FEATURES+="Vulkan,DefaultANGLEVulkan,VulkanFromANGLE,VaapiIgnoreDriverChecks"
	fi
fi

# Disable crash reporting, no simple way to patch it in
CHROMIUM_FLAGS+=" --disable-breakpad"

CHROMIUM_FLAGS+=" --enable-features=$FEATURES"
