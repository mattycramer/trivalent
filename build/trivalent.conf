# Trivalent flags

ARCH="$(arch)"
CHROMIUM_FLAGS=""
FEATURES=""

# NATIVE_WAYLAND=[on|off]
case "$XDG_SESSION_TYPE" in
   wayland)
      NATIVE_WAYLAND="on"
      ;;
   x11)
      NATIVE_WAYLAND="off"
      ;;
esac

# ENABLE_VULKAN=[on|off]
ENABLE_VULKAN="off"

# Other architectures are not tested for and should not be included yet
if [ "$ARCH" == "x86_64" ] ; then
	if [ "$NATIVE_WAYLAND" == "off" ] ; then
		CHROMIUM_FLAGS+=" --enable-native-gpu-memory-buffers"
		CHROMIUM_FLAGS+=" --enable-gpu-memory-buffer-video-frames"
		CHROMIUM_FLAGS+=" --enable-zero-copy"
		CHROMIUM_FLAGS+=" --ignore-gpu-blocklist --disable-gpu-driver-bug-workaround"
		CHROMIUM_FLAGS+=" --enable-gpu-rasterization"
	
		# Enable Vulkan
		# (Vulkan is not supported on Wayland, it is also experimental on Linux)
		ENABLE_VULKAN="on"
	fi

	if [ "$ENABLE_VULKAN" == "on" ] ; then
		CHROMIUM_FLAGS+=" --use-angle=vulkan --use-vulkan"
		FEATURES+=",Vulkan,DefaultANGLEVulkan,VulkanFromANGLE,VaapiIgnoreDriverChecks"
	fi

	# Nvidia has issues on Wayland
	if ! command -v nvidia-smi || [ -z "$DISPLAY" ]; then
		CHROMIUM_FLAGS+=" --ozone-platform-hint=auto"
	fi
fi

# Disable crash reporting, no simple way to patch it in
CHROMIUM_FLAGS+=" --disable-breakpad"

CHROMIUM_FLAGS+=" --enable-features=$FEATURES"
